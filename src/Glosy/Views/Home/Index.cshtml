@model AudioProcessingModel

@{
    ViewData["Title"] = "Home Page";
}

<div class="container">
    <h1 class="display-4 mb-5">Glosy</h1>

    @using (Html.BeginForm("ProcessVoice", "Home", FormMethod.Post, new
    { enctype = "multipart/form-data" }))
    {
        <div class="d-grid gap-3">

            <div>
                @Html.LabelFor(m => m.SourceFile, "Say:")
                @Html.TextBoxFor(m => m.SourceFile, new { type = "file", accept = ".wav", @class = "form-control mb-3", id = "sourceFile" })
                <div id="sourceAudioPreview" class="audio-preview"></div>
                <p>OR</p>
                @Html.TextAreaFor(m => m.TextPrompt, new { type = "file", accept = ".wav", @class = "form-control mb-3", @placeholder="Write what it should say..." , id="textPromptArea"})

            </div>

            <div>
                @Html.LabelFor(m => m.TargetFile, "Make it sound like:")
                @Html.TextBoxFor(m => m.TargetFile, new { type = "file", required = "required", accept = ".wav", @class = "form-control mb-3", id = "targetFile" })
                <div id="targetAudioPreview" class="audio-preview"></div>
            </div>

            <button class="btn btn-primary" type="submit" title="Convert audio file">Convert Voice</button>
        </div>
    }

</div>

<script>
    function createAudioPreview(inputId, previewId) {
        var input = document.getElementById(inputId);
        var preview = document.getElementById(previewId);

        input.addEventListener("change", function() {
            var file = input.files[0];
            if (file) {
                var audio = document.createElement("audio");
                audio.controls = true;
                var objectURL = URL.createObjectURL(file);
                audio.src = objectURL;
                preview.innerHTML = '';
                preview.appendChild(audio);
            }
        });
    }

    createAudioPreview('sourceFile', 'sourceAudioPreview');
    createAudioPreview('targetFile', 'targetAudioPreview');
</script>